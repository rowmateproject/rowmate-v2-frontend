import{x as w,y as m,c as p,w as r,ak as $,o as d,a,f as y,V as c,K as v,d as f,p as A,D,F as E,I as _,u as b,al as B,e as L,i as S,C as U,a3 as x,a9 as I,z as i}from"./index.4d221fed.js";import{_ as M}from"./SectionFullScreen.a3aac654.js";import{_ as g,a as N}from"./FormField.0f8b6bc9.js";import{_ as R}from"./BaseButtons.91076020.js";const G={__name:"LoginView",setup(F){const n=w(),s=m({login:"",pass:"",remember:!0}),o=m({errors:[]}),h=B(),V=()=>{var l=new FormData;l.append("username",s.login),l.append("password",s.pass),i.post(`${n.api}/auth/jwt/login`,l).then(e=>{n.setAccessToken("Bearer "+e.data.access_token),i.defaults.baseURL=n.api,i.defaults.headers.common.Authorization="Bearer "+e.data.access_token,i.get("/users/me").then(u=>{n.setUser(u.data)}).then(function(){h.push("/dashboard")})}).catch(e=>{e.response&&(e.response.status==422?o.errors.push("Field validation error"):e.response.data.detail=="LOGIN_BAD_CREDENTIALS"?o.errors.push("Wrong login"):(e.response.data.detail="LOGIN_USER_NOT_VERIFIED")&&o.errors.push("User is not verified. Make sure that you have verified your E-Mail-Address and that the organisation has accepted your Account."),o.errors=o.errors.slice(-3))})};return(l,e)=>(d(),p($,null,{default:r(()=>[a(M,{bg:"purplePink"},{default:r(({cardClass:u})=>[a(y,{class:c(u),"is-form":"",onSubmit:v(V,["prevent"])},{footer:r(()=>[a(R,null,{default:r(()=>[a(f,{type:"submit",color:"info",label:"Login"}),a(f,{to:"/dashboard",color:"info",outline:"",label:"Back"})]),_:1})]),default:r(()=>[(d(!0),A(E,null,D(o.errors,(t,k)=>(d(),p(L,{onDeleted:C=>o.errors.splice(k,1),key:o.errors,color:"danger"},{default:r(()=>[S(U(t),1)]),_:2},1032,["onDeleted"]))),128)),a(g,{label:"E-Mail",help:"Please enter your E-Mail-Address"},{default:r(()=>[a(_,{modelValue:s.login,"onUpdate:modelValue":e[0]||(e[0]=t=>s.login=t),icon:b(x),name:"login",autocomplete:"username"},null,8,["modelValue","icon"])]),_:1}),a(g,{label:"Password",help:"Please enter your password"},{default:r(()=>[a(_,{modelValue:s.pass,"onUpdate:modelValue":e[1]||(e[1]=t=>s.pass=t),icon:b(I),type:"password",name:"password",class:c(""),autocomplete:"current-password"},null,8,["modelValue","icon"])]),_:1}),a(N,{modelValue:s.remember,"onUpdate:modelValue":e[2]||(e[2]=t=>s.remember=t),name:"remember",label:"Remember","input-value":!0},null,8,["modelValue"])]),_:2},1032,["class","onSubmit"])]),_:1})]),_:1}))}};export{G as default};
